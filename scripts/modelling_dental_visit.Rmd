---
title: "Modelling"
author: "Spiro Stilianoudakis"
date: "9/24/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading Libraries

```{r}
library(openxlsx)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(reshape2)
library(sas7bdat)
library(lubridate)
library(tidyr)
library(tableone)
library(pscl)
library(pROC)
library(DMwR)
library(caret)
library(rattle)
library(randomForest)
library(reprtree)
library(car)
library(ResourceSelection)
library(pscl)
library(countreg)
library("lmtest")
```

# Set working directory

```{r}
setwd("X:/CommonPrograms/Oral Health Services Research Core/Spiro/Claims_Project/data")
```

# Read in Eligibility data

```{r}
eligibility <- readRDS("X:/CommonPrograms/Oral Health Services Research Core/Spiro/Claims_Project/data/ffs_mco_2015_2016_2017_2018.rds")

dim(eligibility) 
#103204    164
#80680   164
#103985    164
length(unique(eligibility$srecip)) 
#103204
#80680
#103985

eligibility <- eligibility[order(eligibility$srecip),]
```


# Read in Claims data

```{r}
#claims <- read.xlsx("X:/CommonPrograms/Oral Health Services Research Core/Spiro/Claims_Project/data/Pregnant_claims_2015_2018.xlsx",
#                    sheet = "Pregnant_claims_2015_2018",
#                    startRow = 1,
#                    colNames = TRUE,
#                    na.strings = "",
#                    detectDates = TRUE)
#dim(claims) #184976     41

unique_claims <- readRDS("X:/CommonPrograms/Oral Health Services Research Core/Spiro/Claims_Project/data/unique_claims.rds")
dim(unique_claims)
#179516     57
#165132     57
#180980     55

unique_claims <- unique_claims %>%
  mutate(SERVICE_DATE2 = mdy(unique_claims$SERVICE_DATE)) %>%
  dplyr::arrange(SRECIP,SERVICE_DATE2)
```

# Creating date of earliest eligibility/dental visit to calculate policy maturation variable

```{r}
mydata <- eligibility

#DOEE <- apply(mydata[,grep(paste0(c("ffs_beg","mco_beg"),collapse = "|"), names(mydata))],1,function(x){min(na.omit(x))})
DOEE <- apply(mydata[,grep(paste0(c("mco_beg","ffs_beg"),collapse = "|"), names(mydata))],1,function(x){min(na.omit(x))})
mydata$policymaturation.E <- floor(as.numeric((as.Date(DOEE)-as.Date("2015-03-01"))/30))
mydata$policymaturation.E[which(mydata$policymaturation.E<0)] <- 0
summary(mydata$policymaturation.E)
#   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#   0.00    0.00    9.00   12.11   22.00   37.00 

d2 <- mydata[which(mydata$srecip %in% unique_claims$SRECIP),]
DOEV <- unique_claims %>%
  dplyr::select(SRECIP, CDT_category, SERVICE_DATE) %>%
  mutate(SERVICE_DATE2 = mdy(unique_claims$SERVICE_DATE)) %>%
  group_by(SRECIP) %>%
  arrange(SRECIP,SERVICE_DATE2) %>%
  filter(row_number()==1)
d2$policymaturation <- floor(as.numeric((as.Date(DOEV$SERVICE_DATE2)-as.Date("2015-03-01"))/30))

mydata$policymaturation.DV <- NA
mydata$policymaturation.DV[which(mydata$srecip %in% d2$srecip)] <- d2$policymaturation
mydata$policymaturation.DV[is.na(mydata$policymaturation.DV)] <- 0
summary(mydata$policymaturation.DV)
#   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#  0.000   0.000   0.000   3.266   0.000  40.000 


#d1 <- eligibility[-which(eligibility$srecip %in% unique_claims$SRECIP),]
#d2 <- eligibility[which(eligibility$srecip %in% unique_claims$SRECIP),]
#
#DOEE <- apply(d1[,grep(paste0(c("ffs_beg","mco_beg"),collapse = "|"), names(d1))],1,function(x){min(na.omit(x))})
#d1$policymaturation1 <- floor(as.numeric((as.Date(DOEE)-as.Date("2015-03-01"))/30))
#
#DOEV <- unique_claims %>%
#  dplyr::select(SRECIP, CDT_category, SERVICE_DATE) %>%
#  mutate(SERVICE_DATE2 = mdy(unique_claims$SERVICE_DATE)) %>%
#  group_by(SRECIP) %>%
#  arrange(SRECIP,SERVICE_DATE2) %>%
#  filter(row_number()==1)
#d2$policymaturation2 <- floor(as.numeric((as.Date(DOEV$SERVICE_DATE2)-as.Date("2015-03-01"))/30))
#
#mydata <- rbind.data.frame(eligibility[-which(eligibility$srecip %in% unique_claims$SRECIP),],
#                           eligibility[which(eligibility$srecip %in% unique_claims$SRECIP),])
#mydata$policymaturation <- c(d1$policymaturation1,d2$policymaturation2)
#mydata$policymaturation[which(mydata$policymaturation<0)] <- 0
```

# Creating response vector based on if patients (SRECIP) in eligibility are in claims

```{r}
mydata$dental_visit <- as.factor(ifelse(mydata$srecip %in% unique_claims$SRECIP, "Yes", "No"))

table(mydata$dental_visit)
#   No   Yes 
#86313 16891 
#   No   Yes 
#65341 15339 
#   No   Yes 
#86982 17003 

prop.table(table(mydata$dental_visit))
#       No       Yes 
#0.8363339 0.1636661 
#       No       Yes 
#0.8098785 0.1901215 
#      No      Yes 
#0.836486 0.163514 
```

# Keeping only necessary variables from eligibility

```{r}
vars <- c("srecip", 
          "Overall_Age_at_earliest_enrollment",
          "Overall_Citizen",
          "Overall_Region",
          "Overall_Race",
          "Overall_R_FIPS",
          "HEALTH_PLANNING_DISTRICT",
          "HEALTH_PLANNING_REGION",
          "me_2015",
          "me_2015_cat",
          "me_2016",
          "me_2016_cat",
          "me_2017",
          "me_2017_cat",
          "me_2018",
          "me_2018_cat",
          "me_overall",
          "me_overall_cat",
          "FY2015",
          "FY2016",
          "FY2017",
          "FY2018",
          "policymaturation.E",
          "policymaturation.DV",
          "dental_visit")
mydata <- mydata[, which(names(mydata) %in% vars)]
dim(mydata) 
#103204     20
#80680    21
#103985     25

```

# Creating variables from claims data

```{r}
patient_level <- unique_claims[!duplicated(unique_claims$SRECIP),]

#FY

patient_level$FY2015_claims <- sapply(patient_level$SRECIP, function(x){ifelse(1 %in% unique_claims$FY_2015[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$FY2016_claims <- sapply(patient_level$SRECIP, function(x){ifelse(1 %in% unique_claims$FY_2016[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$FY2017_claims <- sapply(patient_level$SRECIP, function(x){ifelse(1 %in% unique_claims$FY_2017[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$FY2018_claims <- sapply(patient_level$SRECIP, function(x){ifelse(1 %in% unique_claims$FY_2018[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$FYsum_claims <- rowSums(patient_level[, c("FY2015_claims", "FY2016_claims", "FY2017_claims", "FY2018_claims")])

#CDT

patient_level$Preventive <- sapply(patient_level$SRECIP, function(x){ifelse("PREVENTIVE" %in% unique_claims$CDT_category[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$Diagnostic <- sapply(patient_level$SRECIP, function(x){ifelse("DIAGNOSTIC" %in% unique_claims$CDT_category[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$Restorative <- sapply(patient_level$SRECIP, function(x){ifelse("RESTORATIVE" %in% unique_claims$CDT_category[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$Periodontics <- sapply(patient_level$SRECIP, function(x){ifelse("PERIODONTICS" %in% unique_claims$CDT_category[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$Endodontics <- sapply(patient_level$SRECIP, function(x){ifelse("ENDODONTICS" %in% unique_claims$CDT_category[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$Oral_and_maxillofacial_surgery <- sapply(patient_level$SRECIP, function(x){ifelse("ORAL & MAXILLOFACIAL SURGERY" %in% unique_claims$CDT_category[which(unique_claims$SRECIP %in% x)], 1, 0)})
patient_level$Other <- sapply(patient_level$SRECIP, function(x){ifelse("OTHER" %in% unique_claims$CDT_category[which(unique_claims$SRECIP %in% x)], 1, 0)})

mydata <- left_join(mydata, patient_level[, c("SRECIP", 
                                              "FY2015_claims", 
                                              "FY2016_claims", 
                                              "FY2017_claims", 
                                              "FY2018_claims",
                                              "Preventive",
                                              "Diagnostic",
                                              "Restorative",
                                              "Periodontics",
                                              "Endodontics",
                                              "Oral_and_maxillofacial_surgery",
                                              "Other")], by=c("srecip"="SRECIP"))

dim(mydata)
#103204   31
#80680    32
#103985     36

```

# Classifying patients as HPSA

```{r}
#reading in hpsa data
hpsa_data <- read.csv("X:/CommonPrograms/Oral Health Services Research Core/Spiro/Claims_Project/data/HPSA_data.csv", 
                      header = TRUE,
                      colClasses = c("character",
                                     "character",
                                     "character",
                                     "character",
                                     "character",
                                     "character",
                                     "character",
                                     "character",
                                     "character",
                                     "character"))
dim(hpsa_data) #60 10

hpsa_fips <- c(hpsa_data$R_FIPS,
               hpsa_data$R_FIPS2,
               hpsa_data$R_FIPS3)
hpsa_fips <- hpsa_fips[-which(hpsa_fips=="")]

mydata$HPSA_status <- as.factor(sapply(mydata$Overall_R_FIPS, function(x){ifelse(x %in% hpsa_fips, "Yes", "No")}))
table(mydata$HPSA_status)
#   No   Yes 
#63909 39295
#   No   Yes 
#50181 30499 
#   No   Yes 
#64437 39548 
prop.table(table(mydata$HPSA_status))
#       No       Yes 
#0.6192493 0.3807507 
#       No       Yes 
#0.6219757 0.3780243 
#       No       Yes 
#0.6196759 0.3803241 
```


#Categorizing and cleaning

```{r}
#age category
mydata$Age_category <- ifelse(mydata$Overall_Age_at_earliest_enrollment < 30, "under 30", "over 30")

mydata$Age_category <- factor(mydata$Age_category, levels=c("under 30", "over 30"))
table(mydata$Age_category)
#under 30  over 30 
#   71477    31727 
#under 30  over 30 
#   56313    24367 
#under 30  over 30 
#   71987    31998 

#race
mydata$Overall_Race[which(mydata$Overall_Race=="Hispanic" |
                            mydata$Overall_Race=="Native American/Asian" |
                            mydata$Overall_Race=="Other")] <- "Other"
mydata$Overall_Race <- factor(mydata$Overall_Race, levels=c("White", "Black", "Other"))
table(mydata$Overall_Race)
#White Black Other 
#56672 38727  7805 
#White Black Other 
#43754 31016  5910 
#White Black Other 
#57137 38945  7903 

#citizenship
mydata <- mydata[-which(mydata$Overall_Citizen=="Missing"),]
dim(mydata) 
#103200     33
#80678    34
#103981     38
mydata$Overall_Citizen <- factor(mydata$Overall_Citizen, levels=c("US (or naturalized) citizen", "Non-US citizen"))
table(mydata$Overall_Citizen)
#US (or naturalized) citizen              Non-US citizen 
#                      92038                       11162 
#US (or naturalized) citizen              Non-US citizen 
#                      72617                        8061 
#US (or naturalized) citizen              Non-US citizen 
#                      92574                       11407 

#months enrolled
#mydata$months_enrolled_cat <- ifelse(mydata$months_enrolled <= 10, "3-10 months", ">10 months")
#mydata$months_enrolled_cat <- factor(mydata$months_enrolled_cat, levels=c("3-10 months", ">10 months"))
#table(mydata$months_enrolled_cat, exclude = "ifany")
#3-10 months  >10 months 
#      42077       61123
#3-10 months  >10 months 
#      57798       22880 
#
#mydata$months_enrolled_2015_cat <- ifelse(mydata$months_enrolled_2015 <= 10, "3-10 months", ">10 months")
#mydata$months_enrolled_2015_cat <- factor(mydata$months_enrolled_2015_cat, levels=c("3-10 months", ">10 months"))
#table(mydata$months_enrolled_2015_cat, exclude = "ifany")
#3-10 months  >10 months        <NA> 
#      25693        1980       53005 
#
#mydata$months_enrolled_2016_cat <- ifelse(mydata$months_enrolled_2016 <= 10, "3-10 months", ">10 months")
#mydata$months_enrolled_2016_cat <- factor(mydata$months_enrolled_2016_cat, levels=c("3-10 months", ">10 months"))
#table(mydata$months_enrolled_2016_cat, exclude = "ifany")
#3-10 months  >10 months        <NA> 
#      28392        3381       48905
#
#mydata$months_enrolled_2017_cat <- ifelse(mydata$months_enrolled_2017 <= 10, "3-10 months", ">10 months")
#mydata$months_enrolled_2017_cat <- factor(mydata$months_enrolled_2017_cat, levels=c("3-10 months", ">10 months"))
#table(mydata$months_enrolled_2017_cat, exclude = "ifany")
#3-10 months  >10 months        <NA> 
#      27393        4683       48602 
#
#mydata$months_enrolled_2018_cat <- ifelse(mydata$months_enrolled_2018 <= 10, "3-10 months", ">10 months")
#mydata$months_enrolled_2018_cat <- factor(mydata$months_enrolled_2018_cat, levels=c("3-10 months", ">10 months"))
#table(mydata$months_enrolled_2018_cat, exclude = "ifany")
#3-10 months  >10 months        <NA> 
#      23555        6483       50640 

#region
mydata$Overall_Region <- factor(mydata$Overall_Region)

#using eligibility
##2015
mydata$FY2015 <- factor(ifelse(mydata$FY2015==1, "Yes", "No"))
table(mydata$FY2015)
#   No   Yes 
#53005 27673 
#   No   Yes 
#70000 33981 

##2016
mydata$FY2016 <- factor(ifelse(mydata$FY2016==1, "Yes", "No"))
table(mydata$FY2016)
#   No   Yes 
#48905 31773 
#   No   Yes 
#66128 37853 

##2017
mydata$FY2017 <- factor(ifelse(mydata$FY2017==1, "Yes", "No"))
table(mydata$FY2017)
#   No   Yes 
#48602 32076 
#   No   Yes 
#65543 38438 

##2018
mydata$FY2018 <- factor(ifelse(mydata$FY2018==1, "Yes", "No"))
table(mydata$FY2018)
#   No   Yes 
#50640 30038 
#   No   Yes 
#64562 39419 

mydata_final <- mydata

str(mydata_final)
```

<!--
# Table of demographic variables

##stratifying by dental visit

```{r}
CreateTableOne(vars = c("Overall_Race",
                        "Overall_Citizen",
                        "Overall_Region",
                        "HPSA_status",
                        "Age_category",
                        "Overall_Age_at_earliest_enrollment",
                        "FY2015",
                        "FY2016",
                        "FY2017",
                        "FY2018",
                        "months_enrolled",
                        "months_enrolled_cat",
                        "policymaturation"),
               strata = "dental_visit",
               data = mydata_final)
```

## All eligibility; stratifying by fiscal year (not mutually exclusive)

```{r}
eligibility_table <- cbind.data.frame(
  Variable = c("Had Dental Visit",
               "No",
               "Yes",
               "Age mean (SD)",
               "Age category (%)",
               "Under 30",
               "Over 30",
               "Race (%)",
               "Black",
               "Other",
               "White",
               "HPSA Status (%)",
               "No",
               "Yes",
               #"Months Enrolled (SD)",
               #"Months Enrolled Categorized (%)",
               #"3-10 months",
               #"> 10 months",
               #"Policy Maturation in months (SD)",
               "Citizenship (%)",
               "Non-US citizen",
               "US (or naturalized) citizen",
               "Region (FIPS) (%)",
               "CENTRAL",
               "CHARLOTTESVILLE WESTERN",
               "NORTHERN & WINCHESTER",
               "ROANOKE/ALLEGHANY",
               "SOUTHWEST",
               "TIDEWATER"),
  Total = c("",
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="No"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="No"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30"),])/nrow(mydata_final)*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White"),])/nrow(mydata_final)*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes"),])/nrow(mydata_final)*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$months_enrolled),1), " ", "(", round(sd(mydata_final$months_enrolled),1),"%" ,")"),
             #"",
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months"),])/nrow(mydata_final)*100,1),"%" ,")"),
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months"),])/nrow(mydata_final)*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$policymaturation),1), " ", "(", round(sd(mydata_final$policymaturation),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen"),])/nrow(mydata_final)*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST"),])/nrow(mydata_final)*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER"),])/nrow(mydata_final)*100,1),"%" ,")")),
  FY2015 = c("",
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="No" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="No" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2015=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2015=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$FY2015=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$FY2015=="Yes")]),1),"%" ,")"),
             #"",
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$policymaturation[which(mydata_final$FY2015=="Yes")]),1), " ", "(", round(sd(mydata_final$policymaturation[which(mydata_final$FY2015=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2015=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2015=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015=="Yes"),])*100,1),"%" ,")")),
  FY2016 = c("",
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="No" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="No" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2016=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2016=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$FY2016=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$FY2016=="Yes")]),1),"%" ,")"),
             #"",
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$policymaturation[which(mydata_final$FY2016=="Yes")]),1), " ", "(", round(sd(mydata_final$policymaturation[which(mydata_final$FY2016=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2016=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2016=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes"),])*100,1),"%" ,")")),
  FY2017 = c("",
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="No" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="No" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2017=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2017=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$FY2017=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$FY2017=="Yes")]),1),"%" ,")"),
             #"",
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$policymaturation[which(mydata_final$FY2017=="Yes")]),1), " ", "(", round(sd(mydata_final$policymaturation[which(mydata_final$FY2017=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2017=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2017=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes"),])*100,1),"%" ,")")),
  FY2018 = c("",
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="No" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="No" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2018=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2018=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$FY2018=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$FY2018=="Yes")]),1),"%" ,")"),
             #"",
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             #paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             #paste0(round(mean(mydata_final$policymaturation[which(mydata_final$FY2018=="Yes")]),1), " ", "(", round(sd(mydata_final$policymaturation[which(mydata_final$FY2018=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2018=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2018=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes"),])*100,1),"%" ,")"))
)

names(eligibility_table) <- c("Variable",
                              paste0("Total number of eligible patients (N=", nrow(mydata_final), ")"),
                              paste0("Eligible in 2015 (N=", nrow(mydata_final[which(mydata_final$FY2015=="Yes"),]), ")"),
                              paste0("Eligible in 2016 (N=", nrow(mydata_final[which(mydata_final$FY2016=="Yes"),]), ")"),
                              paste0("Eligible in 2017 (N=", nrow(mydata_final[which(mydata_final$FY2017=="Yes"),]), ")"),
                              paste0("Eligible in 2018 (N=", nrow(mydata_final[which(mydata_final$FY2018=="Yes"),]), ")"))

```

## Just dental visits (subsetted from eligibility); stratifying by fiscal year (not mutually exclusive)

```{r}
dental_visit_table <- cbind.data.frame(
  Variable = c("Age mean (SD)",
               "Age category (%)",
               "Under 30",
               "Over 30",
               "Race (%)",
               "Black",
               "Other",
               "White",
               "HPSA Status (%)",
               "No",
               "Yes",
               "Months Enrolled (SD)",
               "Months Enrolled Categorized (%)",
               "3-10 months",
               "> 10 months",
               "Citizenship (%)",
               "Non-US citizen",
               "US (or naturalized) citizen",
               "Region (FIPS) (%)",
               "CENTRAL",
               "CHARLOTTESVILLE WESTERN",
               "NORTHERN & WINCHESTER",
               "ROANOKE/ALLEGHANY",
               "SOUTHWEST",
               "TIDEWATER"),
  Total = c(paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30"  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")")),
  FY2015 = c(paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2015_claims=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")")),
  FY2016 = c(paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2016=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")")),
  FY2017 = c(paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2017=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")")),
  FY2018 = c(paste0(round(mean(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$Overall_Age_at_earliest_enrollment[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="under 30" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Age_category=="over 30" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Black" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="Other" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Race=="White" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="No" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$HPSA_status=="Yes" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(round(mean(mydata_final$months_enrolled[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes")]),1), " ", "(", round(sd(mydata_final$months_enrolled[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes")]),1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat=="3-10 months" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$months_enrolled_cat==">10 months" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="Non-US citizen" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Citizen=="US (or naturalized) citizen" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             "",
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CENTRAL" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="CHARLOTTESVILLE WESTERN" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="NORTHERN & WINCHESTER" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="ROANOKE/ALLEGHANY" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="SOUTHWEST" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
             paste0(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Overall_Region=="TIDEWATER" & mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$FY2018=="Yes" & mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"))
)

names(dental_visit_table) <- c("Variable",
                              paste0("Total number of eligible patients that had dental visit (N=", nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),]), ")"),
                              paste0("Eligible in 2015 and had dental visit (N=", nrow(mydata_final[which(mydata_final$FY2015_claims==1 & mydata_final$dental_visit=="Yes"),]), ")"),
                              paste0("Eligible in 2016 and had dental visit (N=", nrow(mydata_final[which(mydata_final$FY2016_claims==1 & mydata_final$dental_visit=="Yes"),]), ")"),
                              paste0("Eligible in 2017 and had dental visit (N=", nrow(mydata_final[which(mydata_final$FY2017_claims==1 & mydata_final$dental_visit=="Yes"),]), ")"),
                              paste0("Eligible in 2018 and had dental visit (N=", nrow(mydata_final[which(mydata_final$FY2018_claims==1 & mydata_final$dental_visit=="Yes"),]), ")"))
```

## Dental services; stratifying by fiscal year (not mutually exclusive)

```{r}

services_table <- cbind.data.frame(
  Variable = c("Preventive",
               "No",
               "Yes",
               "Diagnostic",
               "No",
               "Yes",
               "Restorative",
               "No",
               "Yes",
               "Periodontics",
               "No",
               "Yes",
               "Endodontics",
               "No",
               "Yes",
               "Oral & maxillofacial surgery",
               "No",
               "Yes",
               "Other",
               "No",
               "Yes"),
  Total = c("",
            paste0(nrow(mydata_final[which(mydata_final$Preventive==0 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==0  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Preventive==1 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==1  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==0 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==0  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==1 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==1  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Restorative==0 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==0  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Restorative==1 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==1  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==0 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==0  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==1 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==1  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==0 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==0  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==1 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==1  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Other==0 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==0  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Other==1 & mydata_final$dental_visit=="Yes"),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==1  & mydata_final$dental_visit=="Yes"),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),])*100,1),"%" ,")")),
  FY2015 = c("",
             paste0(nrow(mydata_final[which(mydata_final$Preventive==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Preventive==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Restorative==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Restorative==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Other==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Other==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2015_claims==1),])*100,1),"%" ,")")),
  FY2016 = c("",
             paste0(nrow(mydata_final[which(mydata_final$Preventive==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Preventive==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Restorative==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Restorative==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Other==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Other==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2016_claims==1),])*100,1),"%" ,")")),
  FY2017 = c("",
             paste0(nrow(mydata_final[which(mydata_final$Preventive==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Preventive==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Restorative==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Restorative==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Other==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Other==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2017_claims==1),])*100,1),"%" ,")")),
  FY2018 = c("",
             paste0(nrow(mydata_final[which(mydata_final$Preventive==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Preventive==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Preventive==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Diagnostic==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Diagnostic==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Restorative==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Restorative==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Restorative==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Periodontics==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Periodontics==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Endodontics==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Endodontics==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Oral_and_maxillofacial_surgery==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            "",
            paste0(nrow(mydata_final[which(mydata_final$Other==0 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==0  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"),
            paste0(nrow(mydata_final[which(mydata_final$Other==1 & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),]), " ", "(", round(nrow(mydata_final[which(mydata_final$Other==1  & mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])/nrow(mydata_final[which(mydata_final$dental_visit=="Yes" & mydata_final$FY2018_claims==1),])*100,1),"%" ,")"))
)

names(services_table) <- c("Variable",
                              paste0("Total number of eligible patients that had dental visit (N=", nrow(mydata_final[which(mydata_final$dental_visit=="Yes"),]), ")"),
                              paste0("Eligible in 2015 and had dental visit (N=", nrow(mydata_final[which(mydata_final$FY2015_claims==1 & mydata_final$dental_visit=="Yes"),]), ")"),
                              paste0("Eligible in 2016 and had dental visit (N=", nrow(mydata_final[which(mydata_final$FY2016_claims==1 & mydata_final$dental_visit=="Yes"),]), ")"),
                              paste0("Eligible in 2017 and had dental visit (N=", nrow(mydata_final[which(mydata_final$FY2017_claims==1 & mydata_final$dental_visit=="Yes"),]), ")"),
                              paste0("Eligible in 2018 and had dental visit (N=", nrow(mydata_final[which(mydata_final$FY2018_claims==1 & mydata_final$dental_visit=="Yes"),]), ")"))
```
-->

# Modelling

## Logistic regression on full data; probability of having a dental visit

```{r}
#stepwise results:
#                  Df Deviance   AIC
#<none>                  91252 91280
#- HPSA_status      1    91275 91301
#- Age_category     2    91281 91305
#- Overall_Race     4    91322 91342
#- Overall_Citizen  1    91334 91360
#- Overall_Region   5    91625 91643
#no variables were removed

#fydat <- mydata_final[,c(6:9)]
#for(i in 1:ncol(fydat)){
#  year <- as.numeric(gsub("FY", "", names(fydat)[i]))
#  fydat[,i] <- ifelse(fydat[,i]=="Yes", year, 9999)
#}
#mydata_final$eligibilityFY <- apply(fydat,1,min)
#mydata_final$eligibilityFY <- factor(as.character(mydata_final$eligibilityFY), levels=c("2015","2016","2017","2018"))
#table(mydata_final$eligibilityFY)

model1 <- glm(dental_visit ~ me_overall +
                             policymaturation.E +
                             HPSA_status + 
                             Overall_Age_at_earliest_enrollment + 
                             Overall_Race + 
                             Overall_Citizen + 
                             Overall_Region,
              family=binomial(link='logit'),
              data=mydata_final)
summary(model1)
anova(model1, test="Chisq")
Anova(model1, type="II", test="Wald")
anova(model1,
      update(model1, ~1),    
      test="Chisq")
round(exp(cbind(coef(model1), confint(model1))) ,3) 
```

<!--
### Diagnostics

```{r}
hoslem.test(model1$y, fitted(model1), g=10)

plot(fitted(model1),
     rstandard(model1))

#Data.final = mydata %>%
#   select(dental_visit,
#          HPSA_status,
#          Overall_Age_at_earliest_enrollment,
#          Overall_Race,
#          Overall_Citizen,
#          Overall_Region,
#          months_enrolled)
#Data.final = na.omit(Data.final)
#Data.final$predy = predict(model1,
#                           type="response")
### Plot

plot(as.numeric(dental_visit) ~ predy,
     data = Data.final,
     pch = 16,
     xlab="Predicted probability of 1 response",
     ylab="Actual response")

pR2(model1)
#       llh    llhNull         G2   McFadden       r2ML       r2CU 
#-45625.784 -45997.254    742.940      0.008      0.007      0.012 

ll.null <- model1$null.deviance/-2
ll.proposed <- model1$deviance/-2
 
## McFadden's Pseudo R^2 = [ LL(Null) - LL(Proposed) ] / LL(Null)
(ll.null - ll.proposed) / ll.null
 
## The p-value for the R^2
1 - pchisq(2*(ll.proposed - ll.null), df=(length(model1$coefficients)-1))


par(mfrow=c(2,2))
plot(model1)
par(mfrow=c(1,1))

sample_size <- nrow(mydata_final)
cooksd <- cooks.distance(model1)
plot(cooksd, main="Influential Obs by Cooks distance")
abline(h = 4/sample_size, col="red")  # add cutoff line
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4/sample_size, names(cooksd),""), col="red") 

length(which(cooksd>4/sample_size))
#6497


predicted.data <- data.frame(
  probability.of.dv=model1$fitted.values,
  dv=mydata_final$dental_visit)
 
predicted.data <- predicted.data[
  order(predicted.data$probability.of.dv, decreasing=FALSE),]
predicted.data$rank <- 1:nrow(predicted.data)
 
## Lastly, we can plot the predicted probabilities for each sample having
## heart disease and color by whether or not they actually had heart disease
ggplot(data=predicted.data, aes(x=rank, y=probability.of.dv)) +
  geom_point(aes(color=dv), alpha=1, shape=4, stroke=2) +
  xlab("Index") +
  ylab("Predicted probability of a dental visit")
 
prob <- predict(model1, type = "response")
rocp <- roc(mydata_final$dental_visit ~ prob, plot = TRUE, print.auc = TRUE)
```

-->

<!--
## Removing obs with high cooks distances

```{r}
mydata_final_filt <- mydata_final[-which(cooksd>(4/sample_size)),]
dim(mydata_final_filt) #96703     6
table(mydata_final_filt$dental_visit)
#   No   Yes 
#86309 10394

model_filt <- glm(dental_visit ~ HPSA_status + Age_category + Overall_Race + Overall_Citizen + Overall_Region,
              family=binomial(link='logit'),
              data=mydata_final_filt)
summary(model_filt)

#null model
glm.null <- glm(dental_visit ~ 1, data = mydata_final_filt, family = binomial(link='logit'))
#full model
glm.full <- glm(dental_visit ~ ., data = mydata_final_filt, family = binomial(link='logit'))
  
best.fit.bwd = step(glm.full,
                      data = mydata_final_filt, 
                      direction="backward",
                      trace=2)
  
round(exp(cbind(coef(model_filt), confint(model_filt))) ,3) 

ll.null <- model_filt$null.deviance/-2
ll.proposed <- model_filt$deviance/-2
 
## McFadden's Pseudo R^2 = [ LL(Null) - LL(Proposed) ] / LL(Null)
(ll.null - ll.proposed) / ll.null
 
## The p-value for the R^2
1 - pchisq(2*(ll.proposed - ll.null), df=(length(model_filt$coefficients)-1))

prob <- predict(model_filt, type = "response")
rocp <- roc(mydata_final_filt$dental_visit ~ prob, plot = TRUE, print.auc = TRUE)
```


## Logistic regression on balanced data

### RUS

```{r}
#rus
set.seed(321)
sampids <- sample(x = which(mydata_final_filt$dental_visit=="No"),
                        size = length(which(mydata_final_filt$dental_visit=="Yes")),
                        replace = FALSE)
mydata_final_filt_rus <- rbind.data.frame(mydata_final_filt[which(mydata_final_filt$dental_visit=="Yes"),],
                        mydata_final_filt[sampids,])
##Randomly shuffle the data
set.seed(321)
mydata_final_filt_rus <- mydata_final_filt_rus[sample(nrow(mydata_final_filt_rus)),]
table(mydata_final_filt_rus$dental_visit)

model2 <- glm(dental_visit ~ HPSA_status + Age_category + Overall_Race + Overall_Citizen + Overall_Region,
              family=binomial(link='logit'),
              data=mydata_final_filt_rus)
summary(model2)

ll.null <- model2$null.deviance/-2
ll.proposed <- model2$deviance/-2
 
## McFadden's Pseudo R^2 = [ LL(Null) - LL(Proposed) ] / LL(Null)
(ll.null - ll.proposed) / ll.null
 
## The p-value for the R^2
1 - pchisq(2*(ll.proposed - ll.null), df=(length(model2$coefficients)-1))

prob <- predict(model2, type = "response")
rocp <- roc(mydata_final_filt_rus$dental_visit ~ prob, plot = TRUE, print.auc = TRUE)
```

### SMOTE

```{r}
set.seed(123)
mydata_final_filt_smote <- SMOTE(dental_visit ~ .,
                            data=mydata_final_filt, 
                            perc.over = 100, 
                            perc.under = 200)
set.seed(123)
mydata_final_filt_smote <- mydata_final_filt_smote[sample(nrow(mydata_final_filt_smote)),]
dim(mydata_final_filt_smote)
table(mydata_final_filt_smote$dental_visit)

model3 <- glm(dental_visit ~ HPSA_status + Age_category + Overall_Race + Overall_Citizen + Overall_Region,
              family=binomial(link='logit'),
              data=mydata_final_filt_smote)
summary(model3)

ll.null <- model3$null.deviance/-2
ll.proposed <- model3$deviance/-2
 
## McFadden's Pseudo R^2 = [ LL(Null) - LL(Proposed) ] / LL(Null)
(ll.null - ll.proposed) / ll.null
 
## The p-value for the R^2
1 - pchisq(2*(ll.proposed - ll.null), df=(length(model3$coefficients)-1))

prob <- predict(model3, type = "response")
rocp <- roc(mydata_final_filt_smote$dental_visit ~ prob, plot = TRUE, print.auc = TRUE)
```

## Decision Tree

```{r}
x <- model.matrix(~HPSA_status + 
                   Overall_Race + 
                   Overall_Citizen + 
                   Overall_Region, data = mydata_final)
tree_data <- cbind.data.frame(dental_visit=mydata_final$dental_visit,
                              x[,-1],
                              Overall_Age_at_earliest_enrollment=mydata_final$Overall_Age_at_earliest_enrollment,
                              months_enrolled=mydata_final$months_enrolled)
names(tree_data) <- make.names(colnames(tree_data))

model.tree = train(dental_visit ~ ., 
                  data=tree_data, 
                  method="rpart", 
                  trControl = trainControl(method = "cv", number=5),
                  control =rpart.control(minsplit =1,minbucket=1, cp=0))

plot(model.tree$finalModel, uniform=TRUE,
     main="Classification Tree")
text(model.tree$finalModel$finalModel, use.n.=TRUE, all=TRUE, cex=.8)

fancyRpartPlot(model.tree$finalModel)
```

-->

## Logistic regression on partial data; given you had a dental visit, probability of having preventative-type service

```{r}
mydata_final2 <- mydata_final[which(mydata_final$dental_visit=="Yes"),]

mydata_final2$Preventive <- factor(ifelse(mydata_final2$Preventive==1, "Yes", "No"))

#mydata_final2$FY2015_claims <- factor(ifelse(mydata_final2$FY2015_claims==1,"Yes","No"))
#mydata_final2$FY2016_claims <- factor(ifelse(mydata_final2$FY2016_claims==1,"Yes","No"))
#mydata_final2$FY2017_claims <- factor(ifelse(mydata_final2$FY2017_claims==1,"Yes","No"))
#mydata_final2$FY2018_claims <- factor(ifelse(mydata_final2$FY2018_claims==1,"Yes","No"))

model2 <- glm(Preventive ~ me_overall +
                             policymaturation.DV +
                             HPSA_status + 
                             Overall_Age_at_earliest_enrollment + 
                             Overall_Race + 
                             Overall_Citizen + 
                             Overall_Region,
              family=binomial(link='logit'),
              data=mydata_final2)
summary(model2)
anova(model2, test="Chisq")
Anova(model2, type="II", test="Wald")
anova(model2,
      update(model2, ~1),    
      test="Chisq")
round(exp(cbind(coef(model2), confint(model2))) ,3) 
```

## Logistic regression on partial data; given you had a dental visit, probability of having treatment-type service

```{r}
mydata_final2$Treatment <- factor(ifelse(mydata_final2$Preventive=="Yes" & mydata_final2$Diagnostic==1, "No", "Yes"))

model3 <- glm(Treatment ~ me_overall +
                             policymaturation.DV +
                             HPSA_status + 
                             Overall_Age_at_earliest_enrollment + 
                             Overall_Race + 
                             Overall_Citizen + 
                             Overall_Region,
              family=binomial(link='logit'),
              data=mydata_final2)
summary(model3)
anova(model3, test="Chisq")
Anova(model3, type="II", test="Wald")
anova(model3,
      update(model3, ~1),    
      test="Chisq")
round(exp(cbind(coef(model3), confint(model3))) ,3) 
```


## Two-Part Models

### Getting number of dental visits as outcome variable

```{r}
#number of visits
num_visits <- unique_claims %>%
  group_by(SRECIP) %>%
  summarize(n = length(unique(SERVICE_DATE)))
mean(num_visits$n)
sd(num_visits$n)

mydata_twopt <- left_join(mydata_final, num_visits, by=c("srecip"="SRECIP"))
names(mydata_twopt)[29] <- "NumVisits"
dim(mydata_twopt)
#103200     29

#filling in missing values with zeros
mydata_twopt$NumVisits[is.na(mydata_twopt$NumVisits)] <- 0
summary(mydata_twopt$NumVisits)
qplot(NumVisits, data = mydata_twopt)

mydata_twopt$Preventive[is.na(mydata_twopt$Preventive)] <- 0
mydata_twopt$Diagnostic[is.na(mydata_twopt$Diagnostic)] <- 0
mydata_twopt$Restorative[is.na(mydata_twopt$Restorative)] <- 0
mydata_twopt$Periodontics[is.na(mydata_twopt$Periodontics)] <- 0
mydata_twopt$Endodontics[is.na(mydata_twopt$Endodontics)] <- 0
mydata_twopt$Oral_and_maxillofacial_surgery[is.na(mydata_twopt$Oral_and_maxillofacial_surgery)] <- 0
mydata_twopt$Other[is.na(mydata_twopt$Other)] <- 0

mydata_twopt$Preventive <- as.factor(ifelse(mydata_twopt$Preventive==1,"Yes", "No"))
mydata_twopt$Treatment <- as.factor(ifelse(mydata_twopt$Preventive==1 | mydata_twopt$Diagnostic==1, "No", "Yes"))
```

### Hurdle model 1 (preventative vs non-preventatitive)

```{r}
table(mydata_twopt$Preventive[which(mydata_twopt$NumVisits>0)])

mod1.hurdle <- hurdle(NumVisits ~ Preventive |
                             HPSA_status + 
                             Overall_Age_at_earliest_enrollment + 
                             Overall_Race + 
                             Overall_Citizen + 
                             Overall_Region + 
                             months_enrolled,
                     data = mydata_twopt,
                     dist = "poisson",
                     zero.dist = "binomial")
summary(mod1.hurdle)
rootogram(mod1.hurdle)

mean(mydata_twopt$NumVisits[which(mydata_twopt$NumVisits>0)])
var(mydata_twopt$NumVisits[which(mydata_twopt$NumVisits>0)])

mod1.hurdle.negbin <- hurdle(NumVisits ~ Preventive +
                             HPSA_status + 
                             Overall_Age_at_earliest_enrollment + 
                             Overall_Race + 
                             Overall_Citizen + 
                             Overall_Region + 
                             months_enrolled |
                             HPSA_status + 
                             Overall_Age_at_earliest_enrollment + 
                             Overall_Race + 
                             Overall_Citizen + 
                             Overall_Region + 
                             months_enrolled,
                     data = mydata_twopt,
                     dist = "negbin",
                     zero.dist = "binomial")
summary(mod1.hurdle.negbin)
rootogram(mod1.hurdle.negbin)

lrtest(mod1.hurdle, mod.hurdle.negbin)

expCoef <- exp(coef((mod1.hurdle.negbin)))
expCoef <- matrix(expCoef, ncol = 1)
rownames(expCoef) <- names(coef(mod1.hurdle.negbin))
expCoef

cbind(round(expCoef,3),paste0("(",round(exp(confint(mod1.hurdle.negbin)),3)[,1], ",", " ", round(exp(confint(mod1.hurdle.negbin)),3)[,2], ")"))
```

### Hurdle model 2 (treatment vs non-treatment)

```{r}
table(mydata_twopt$Treatment[which(mydata_twopt$NumVisits>0)])

mod2.hurdle.negbin <- hurdle(NumVisits ~ Treatment +
                             HPSA_status + 
                             Overall_Age_at_earliest_enrollment + 
                             Overall_Race + 
                             Overall_Citizen + 
                             Overall_Region + 
                             months_enrolled |
                             HPSA_status + 
                             Overall_Age_at_earliest_enrollment + 
                             Overall_Race + 
                             Overall_Citizen + 
                             Overall_Region + 
                             months_enrolled,
                     data = mydata_twopt,
                     dist = "negbin",
                     zero.dist = "binomial")
summary(mod2.hurdle.negbin)
rootogram(mod2.hurdle.negbin)

expCoef <- exp(coef((mod2.hurdle.negbin)))
expCoef <- matrix(expCoef, ncol = 1)
rownames(expCoef) <- names(coef(mod2.hurdle.negbin))
expCoef

cbind(round(expCoef,3),paste0("(",round(exp(confint(mod2.hurdle.negbin)),3)[,1], ",", " ", round(exp(confint(mod2.hurdle.negbin)),3)[,2], ")"))
```

